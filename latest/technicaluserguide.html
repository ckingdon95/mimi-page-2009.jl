<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Technical User Guide · mimi-page.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link href="assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>mimi-page.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="search.html"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="index.html">Home</a></li><li><a class="toctext" href="gettingstarted.html">Getting started</a></li><li><a class="toctext" href="model-structure.html">Model Structure</a></li><li class="current"><a class="toctext" href="technicaluserguide.html">Technical User Guide</a><ul class="internal"><li><a class="toctext" href="#Folder-Structure-1">Folder Structure</a></li><li><a class="toctext" href="#Code-format-1">Code format</a></li></ul></li><li><a class="toctext" href="validation.html">Model Validation</a></li></ul></nav><article id="docs"><header><nav><ul><li><a href="technicaluserguide.html">Technical User Guide</a></li></ul><a class="edit-page" href="https://github.com/anthofflab/mimi-page.jl/blob/master/docs/src/technicaluserguide.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>Technical User Guide</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="Technical-User-Guide-1" href="#Technical-User-Guide-1">Technical User Guide</a></h1><h2><a class="nav-anchor" id="Folder-Structure-1" href="#Folder-Structure-1">Folder Structure</a></h2><p>The folders are organized as follows.</p><p><strong>src</strong></p><p>Here you will find the model components, i.e. the code.</p><p><strong>data</strong></p><p>Here you will find data that are utilized by the components. This includes initial values, input parameters, and socioeconomic scenarios. The data we used to calibrate our model comes from the PAGE09 Excel version, generously provided by Chris Hope.</p><p><strong>docs</strong></p><p>The documentation is stored here, including the the index, getting started, scientific guide, and this file.</p><p><strong>test</strong></p><p>This folder contains files that were and still can be used to make sure a component is fully functional. The tests run each individual component separately so you can diagnose which might not be working and why. (They should all work). The tests take inputs, normally provided by other components, and produce outputs that often would otherwise go to other compontents.  Both are stored in <code>test/validationdata</code>. There is also test for the entire model in &quot;test_mainmodel.jl&quot;</p><p><strong>data/policy-b</strong> and <strong>test/validationdata/policy-b</strong></p><p>PAGE &#39;09 provides a low emissions policy scenario.  The input data for that scenario is provided in <code>data/policy-b</code> and validation data in <code>test/validationdata/policy-b</code>.  See <code>test/test_mainmodel_policyb/jl</code> for an example of its usage.  The code is designed so that other policies can be added in the same fashion.</p><h2><a class="nav-anchor" id="Code-format-1" href="#Code-format-1">Code format</a></h2><ul><li><p>The code is written in Julia (v0.5 or greater).</p></li><li><p>The data are in CSV format for easy portability and manipulation.</p></li><li><p>The docs are in Markdown format for readability on github.</p></li></ul><p>Each component in the model (and the test files as well) has the same basic mimi structure.</p><p>Here we show the code for the CO2 Forcing component to provide an example of the mimi structure with comments.</p><pre><code class="language-none"># Imports the Mimi package. This is only done with certain components,
# because once it is loaded in the model, it becomes redundant code.
using Mimi</code></pre><p>Now we will define the component with its parameters (inputs) and variables (outputs).</p><pre><code class="language-none">@defcomp co2forcing begin # this defines the component, gives it a name, and starts the code chunk
    # The value of parameters are specified elsewhere in the code,
	# either as a external value or the output of a variable in another component

    c_CO2concentration = Parameter(index=[time],unit=&quot;ppbv&quot;) # Sets a parameter which is indexed by time.
    f0_CO2baseforcing = Parameter(unit=&quot;W/m2&quot;)
    fslope_CO2forcingslope = Parameter(unit=&quot;W/m2&quot;)
    c0_baseCO2conc = Parameter(unit=&quot;ppbv&quot;)
	
    f_CO2forcing = Variable(index=[time],unit=&quot;W/m2&quot;) # defines a variable that will be evaluated in the component
end</code></pre><p>Next we will create the function that carries the components equations. These equations utilize the parameters and variables defined above.</p><pre><code class="language-none">function run_timestep(s::co2forcing, t::Int64)
    v = s.Variables
    p = s.Parameters

    # Eq.13 in Hope 2006
    v.f_CO2forcing[t] = p.f0_CO2baseforcing + p.fslope_CO2forcingslope*log(p.c_CO2concentration[t]/p.c0_baseCO2conc)
end</code></pre><p>Lastly, we define a function that is used to add the component to the main model. Here we can also set exogenous parameters.</p><pre><code class="language-none">function addCO2forcing(model::Model)
    co2forcingcomp = addcomponent(model, co2forcing)

    co2forcingcomp[:fslope_CO2forcingslope] = 5.5
    co2forcingcomp[:f0_CO2baseforcing] = 1.735
    co2forcingcomp[:c0_baseCO2conc] = 395000.

    co2forcingcomp
end</code></pre><p>In the <code>getpagefunction.jl</code> file, you will find code that sends variables between components. For example,</p><pre><code class="language-none">CO2forcing[:c_CO2concentration] = CO2cycle[:c_CO2concentration] # incoming = outgoing.
# In this case, the `c_CO2concentration` is constructed in the `CO2cycle` component
# and then sent to the `CO2forcing` component.</code></pre><p>Once the model has run, you can access variable outputs with this syntax (note, that the model is referred to as <code>m</code>):</p><pre><code class="language-none">m[:co2forcing, :f_CO2forcing]</code></pre><footer><hr/><a class="previous" href="model-structure.html"><span class="direction">Previous</span><span class="title">Model Structure</span></a><a class="next" href="validation.html"><span class="direction">Next</span><span class="title">Model Validation</span></a></footer></article></body></html>
